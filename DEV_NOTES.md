# Development Notes

## Firebase Emulator

- The application is configured to automatically connect to the Firebase Authentication Emulator when running on `localhost` or `127.0.0.1`.
- The connection logic is located in `js/firebase-auth.js`.
- The emulator UI is typically available at `http://localhost:4000`.
- To use the emulator, ensure it's running before starting the local development server. You can start the emulators using the Firebase CLI command:

  ```bash
  firebase emulators:start --only auth
  ```

  (Adjust the command if you use other emulators like Firestore or Functions).

- ## Database Integration

- When running locally with the emulator, the backend API (`/api/update_session.php`) will still sync user data (UID, email, display name, photo URL, last login) to the MySQL `users` table.
- The data synced will be the data generated by the **emulator** (e.g., emulator UIDs).
- This ensures your local database reflects the state of your local emulated authentication environment. 

## Local Database Setup & Secure Configuration (MAMP)

- Sensitive configuration details (Database credentials, API Keys) are stored in `private/secure_variables.php`.
- This file is **required** for the application to function correctly locally and in production.
- It is correctly ignored by Git (via `.gitignore`) to prevent committing sensitive credentials.
- The file **MUST** return a PHP array with the following structure:

  ```php
  <?php
  // private/secure_variables.php
  
  return [
      // Database Credentials (Example for MAMP)
      'DB_HOST' => 'localhost',       // Or '127.0.0.1'
      'DB_PORT' => '3306',            // Check your MAMP MySQL port
      'DB_NAME' => 'your_local_db_name', // Your local database name
      'DB_USER' => 'root',            // MAMP default user
      'DB_PASS' => 'root',            // MAMP default password
      
      // Discord Application Credentials
      'discord' => [
          'client_id'         => 'YOUR_DISCORD_CLIENT_ID',
          'client_secret'     => 'YOUR_DISCORD_CLIENT_SECRET',
          'redirect_uri'      => 'YOUR_PRODUCTION_REDIRECT_URI',
          'dev_redirect_uri'  => 'YOUR_DEVELOPMENT_REDIRECT_URI', // e.g., http://localhost:8888/discord/discord-callback.php
          'api_url'           => 'https://discord.com/api/v10' 
      ],
  
      // Add other secure configurations here if needed
  ];
  ```

- The database connection script (`config/db_connect.php`) and Discord configuration (`discord/discord-config.php`) have been updated to read credentials from this array structure.
- **PHP Error Log:** MAMP's PHP error log, useful for debugging, is typically at `/Applications/MAMP/logs/php_error.log`.

## Backend / PHP Notes

- **Session Key:** The user identifier stored in the PHP session (`$_SESSION`) is consistently named `uid`, **not** `user_id`. Ensure all API scripts that check for a logged-in user use `$_SESSION['uid']`. 