# Development Notes

## Documentation Maintenance
- After the end of each prompt session, be sure to update the CODE_MAP.md with any changes.

## Color Scheme. 

- Always check the /css/styles.css when building new elements to ensure the correct colors are used.

## Firebase Emulator

- The application is configured to automatically connect to the Firebase Authentication Emulator when running on `localhost` or `127.0.0.1`.
- The connection logic is located in `js/firebase-auth.js`.
- The emulator UI is typically available at `http://localhost:4000`.
- To use the emulator, ensure it's running before starting the local development server. You can start the emulators using the Firebase CLI command:

  ```bash
  firebase emulators:start --only auth
  ```

  (Adjust the command if you use other emulators like Firestore or Functions).

- ## Database Integration

- When running locally with the emulator, the backend API (`/api/update_session.php`) will still sync user data (UID, email, display name, photo URL, last login) to the MySQL `users` table.
- The data synced will be the data generated by the **emulator** (e.g., emulator UIDs).
- This ensures your local database reflects the state of your local emulated authentication environment. 

## Local Database Setup & Secure Configuration (MAMP)

- Sensitive configuration details (Database credentials, API Keys) are stored in `private/secure_variables.php`.
- This file is **required** for the application to function correctly locally and in production.
- It is correctly ignored by Git (via `.gitignore`) to prevent committing sensitive credentials.
- The file **MUST** return a PHP array with the following structure:

  ```php
  <?php
  // private/secure_variables.php
  
  return [
      // Database Credentials (Example for MAMP)
      'DB_HOST' => 'localhost',       // Or '127.0.0.1'
      'DB_PORT' => '3306',            // Check your MAMP MySQL port
      'DB_NAME' => 'your_local_db_name', // Your local database name
      'DB_USER' => 'root',            // MAMP default user
      'DB_PASS' => 'root',            // MAMP default password
      
      // Discord Application Credentials
      'discord' => [
          'client_id'         => 'YOUR_DISCORD_CLIENT_ID',
          'client_secret'     => 'YOUR_DISCORD_CLIENT_SECRET',
          'redirect_uri'      => 'YOUR_PRODUCTION_REDIRECT_URI',
          'dev_redirect_uri'  => 'YOUR_DEVELOPMENT_REDIRECT_URI', // e.g., http://localhost:8888/discord/discord-callback.php
          'api_url'           => 'https://discord.com/api/v10' 
      ],
  
      // Add other secure configurations here if needed
  ];
  ```

- The database connection script (`config/db_connect.php`) and Discord configuration (`discord/discord-config.php`) have been updated to read credentials from this array structure.
- **PHP Error Log:** MAMP's PHP error log, useful for debugging, is typically at `/Applications/MAMP/logs/php_error.log`.

## Backend / PHP Notes

- **Session Key:** The user identifier stored in the PHP session (`$_SESSION`) is consistently named `uid`, **not** `user_id`. Ensure all API scripts that check for a logged-in user use `$_SESSION['uid']`.

## UI / CSS Notes

### Button Styles

There are two primary button styles used throughout the application for consistency:

1.  **Default Buttons (Icon + Text):**
    *   **Usage:** Standard actions (Save, Create, Cancel, Connect, Add Item, etc.).
    *   **Structure:** `<button class="btn btn-{color}"> <i class="fas fa-{icon-name}"></i> Button Text </button>`
    *   **CSS Classes:** Base `.btn` class combined with a semantic color class from `css/styles.css` (e.g., `.btn-primary` (blue), `.btn-submit` (yellow), `.btn-danger` (red), `.btn-secondary` (gray), `.btn-discord` (discord blue)).
    *   **Example:** `<button id="add-inventory-item-btn" class="btn btn-submit" title="Add Item"> <i class="fas fa-plus"></i> Add Item </button>`

2.  **Icon-Only Buttons (Round):**
    *   **Usage:** Compact actions within tables, lists, or tight spaces where text is unnecessary (e.g., View Details, Edit, Delete, Set GM).
    *   **Structure:** `<button class="{base-round-class} {specific-modifier-class}" title="Action Description"> <i class="fas fa-{icon-name}"></i> </button>`
    *   **CSS Classes:** Requires a shared base class defining the round shape, size, and icon centering (e.g., `.inventory-action-btn` defined in `inventory_system/inventory_system.css`) and a specific modifier class for background color and function (e.g., `.inventory-details-btn`, `.inventory-delete-btn`).
    *   **Styling:** Fixed `width`/`height` (e.g., 30px), `border-radius: 50%`, `display: flex`, `align-items: center`, `justify-content: center`, `color: var(--white)`.
    *   **Example:** `<button class="inventory-action-btn inventory-delete-btn" title="Remove Item"> <i class="fas fa-trash-alt"></i> </button>`

Always refer to `css/styles.css` for base button styles and color variables, and specific component CSS (like `inventory_system/inventory_system.css` or `css/account.css`) for specialized button implementations. 

## Inventory Item Type Tags

Inventory items display their type as a colored tag next to the item name. This uses a base CSS class `.item-type-tag` for structure and color modifier classes for appearance.

- **Base Class:** `.item-type-tag` (in `inventory_system/inventory_system.css`) defines padding, border-radius, font size, etc.
- **Color Modifier Classes:**
    - `.item-tag-default`: Default style (Teal, using `--accent-secondary`). Applied to most item types.
    - `.item-tag-magic`: Magic item style (Gold/Yellow, using `#FBD029`). Applied to `Relic` type items currently.
    - *Add more classes here as needed (e.g., `.item-tag-consumable`, `.item-tag-gear`).*
- **PHP Implementation:** The `inventory_system/inventory_display.php` script determines which modifier class to add based on the `item_type` fetched from the database.
- **Consistency:** When adding new item types or desiring different colors, create a new modifier class in `inventory_system/inventory_system.css` and update the conditional logic in `inventory_system/inventory_display.php`. 